{% extends "base.html" %}

{% block title %}{{ movie.title }} - MovieWeb App{% endblock %}

{% block content %}
<div class="container">
    <div style="text-align: center; margin-bottom: 2rem;">
        <a href="/users/{{ user.id }}" class="btn btn-secondary">‚Üê Back to {{ user.name }}'s Movies</a>
    </div>
    
    <!-- Movie Details Section -->
    <div class="movie-detail-container">
        <div class="movie-detail-header">
            <div class="movie-poster-large">
                {% if movie.poster and movie.poster != 'N/A' %}
                    <img src="{{ movie.poster }}" alt="{{ movie.title }} poster" class="poster-image-large">
                {% else %}
                    <div class="no-poster-large">No Poster</div>
                {% endif %}
            </div>
            
            <div class="movie-info-large">
                <h1 class="movie-title">{{ movie.title }} ({{ movie.year }})</h1>
                <div class="movie-details">
                    <p><strong>Director:</strong> {{ movie.director }}</p>
                    {% if movie.genre %}<p><strong>Genre:</strong> {{ movie.genre }}</p>{% endif %}
                    {% if movie.rating %}<p><strong>Rating:</strong> {{ movie.rating }}/10</p>{% endif %}
                </div>

                <div class="movie-actions">
                    <a href="{{ url_for('trivia.movie_trivia', user_id=user.id, movie_id=movie.id) }}"
                       class="btn btn-primary">üß† Movie Trivia (7 Questions)</a>
                    <a href="{{ url_for('trivia.movie_leaderboard', user_id=user.id, movie_id=movie.id) }}"
                       class="btn btn-secondary">üèÜ Movie Leaderboard</a>
                    <a href="/users/{{ user.id }}/update_movie/{{ movie.id }}" class="btn btn-warning">Edit Movie</a>
                    <a href="/users/{{ user.id }}/delete_movie/{{ movie.id }}"
                       class="btn btn-danger"
                       onclick="return confirm('Are you sure you want to delete this movie?')">Delete Movie</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reviews Section -->
    <div class="reviews-section">
        <h2>Reviews</h2>
        
        <!-- Add Review Form -->
        <div class="add-review-form">
            <h3>Write a Review</h3>
            <form method="POST" action="/users/{{ user.id }}/movies/{{ movie.id }}/add_review">
                <div class="form-group">
                    <label for="content" class="form-label">Your Review:</label>
                    <textarea id="content" name="content" class="form-input" rows="4" required placeholder="Write your review here..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="reviewer_rating" class="form-label">Your Rating (1-10):</label>
                    <input type="number" id="reviewer_rating" name="reviewer_rating" class="form-input" min="1" max="10" placeholder="Optional">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-success">Submit Review</button>
                </div>
            </form>
        </div>
        
        <!-- Display Reviews -->
        {% if reviews %}
            <div class="reviews-list">
                {% for review in reviews %}
                    <div class="review-item">
                        <div class="review-header">
                            {% if review.reviewer_rating %}
                                <span class="review-rating">{{ review.reviewer_rating }}/10 ‚≠ê</span>
                            {% endif %}
                            <span class="review-date">{{ review.created_at[:10] }}</span>
                        </div>
                        
                        <div class="review-content">
                            {{ review.content }}
                        </div>
                        
                        <div class="review-actions">
                            <a href="/users/{{ user.id }}/movies/{{ movie.id }}/like_review/{{ review.id }}"
                               class="btn btn-primary btn-small">
                                üëç Like ({{ review.likes }})
                            </a>
                            <a href="/users/{{ user.id }}/movies/{{ movie.id }}/edit_review/{{ review.id }}"
                               class="btn btn-warning btn-small">
                                ‚úèÔ∏è Edit
                            </a>
                            <a href="/users/{{ user.id }}/movies/{{ movie.id }}/delete_review/{{ review.id }}"
                               class="btn btn-danger btn-small"
                               onclick="return confirm('Are you sure you want to delete this review?')">
                                üóëÔ∏è Delete
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-reviews">
                <p>No reviews yet. Be the first to write one!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}